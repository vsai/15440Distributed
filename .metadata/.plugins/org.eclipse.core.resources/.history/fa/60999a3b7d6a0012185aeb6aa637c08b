package processManaging;

import java.lang.reflect.Constructor;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Scanner;

import processMigration.MigratableProcess;
import processMigration.MigratableProcesses;

public class ProcessManager {

	/**
	 * @param args
	 */
		public ProcessManager (){
			
		}
	
	public static void main(String[] args) {
		HashMap<MigratableProcess, String[]> processes;
		boolean isSlave;
		if (args.length == 0) {
			//run process manager as master
			System.out.println("I'm a MASTER");
			isSlave = false;
			//only masters can start new processes
			
		} else if (args.length == 2 && args[0].equals("-c")) {
			String hostname = args[1];
			System.out.println("I'm a SLAVE. Master is :" + hostname);
			isSlave = true;
		} else {
			System.out.println("Invalid input to startup ProcessManager");
			System.exit(0);
		}
		
		processes = new HashMap<MigratableProcess, String[]>();
		
		Scanner sc = new Scanner(System.in);
		while(true){
			System.out.println("Prompt for input ==>");
			String input = sc.nextLine();
			
			if (input.equals("ps")) {
				for (MigratableProcess p : processes.keySet()){
					System.out.print(p.getClass().getName());
					String[] pArgs = processes.get(p);
					for (String arg : pArgs){
						System.out.print(arg);
					}
					System.out.println();
				}
			} else if (input.equals("quit")){
				
			} else {//Process input with commands
				String in[] = input.split(" ", 2);
				String processArgs[] = in[1].split(" ");
				try {
					Class<?> myClass = Class.forName(in[0]);
					Constructor myCtor = myClass.getConstructor();
					Thread t = new Thread(myCtor.newInstance(processArgs));
				} catch (ClassNotFoundException e) {
					System.out.println("You have inputted an invalid process. Try again");
					e.printStackTrace();
				} catch (SecurityException e) {
					System.out.println("You don't have access to the constructor of this class");
					e.printStackTrace();
				} catch (NoSuchMethodException e) {
					System.out.println("This process does not have a constructor");
					e.printStackTrace();
				}
			}		
		}
	}
}